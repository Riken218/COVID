try:
    from Work import*
except:
    from Workspace import*
print('\n')

'''Add derivatives from confirmed and plot time change'''

#confirmed = 'https://data.humdata.org/hxlproxy/api/data-preview.csv?url=https%3A%2F%2Fraw.githubusercontent.com%2FCSSEGISandData%2FCOVID-19%2Fmaster%2Fcsse_covid_19_data%2Fcsse_covid_19_time_series%2Ftime_series_19-covid-Confirmed.csv&filename=time_series_2019-ncov-Confirmed.csv'
#confirmed = 'https://data.humdata.org/hxlproxy/api/data-preview.csv?url=https%3A%2F%2Fraw.githubusercontent.com%2FCSSEGISandData%2FCOVID-19%2Fmaster%2Fcsse_covid_19_data%2Fcsse_covid_19_time_series%2Ftime_series_covid19_confirmed_global.csv&filename=time_series_covid19_confirmed_global.csv'
confirmed = 'https://github.com/CSSEGISandData/COVID-19/raw/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_confirmed_global.csv'
cases = pd.read_csv(confirmed)

recovered = 'https://github.com/CSSEGISandData/COVID-19/raw/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_recovered_global.csv'
recov = pd.read_csv(recovered)

dead = 'https://github.com/CSSEGISandData/COVID-19/raw/master/csse_covid_19_data/csse_covid_19_time_series/time_series_covid19_deaths_global.csv'
deaths = pd.read_csv(dead)

dates = ['1/22/20','1/23/20','1/24/20','1/25/20','1/26/20','1/27/20','1/28/20','1/29/20','1/30/20','1/31/20',
         '2/1/20','2/2/20','2/3/20','2/4/20','2/5/20','2/6/20','2/7/20','2/8/20','2/9/20','2/10/20','2/11/20',
         '2/12/20','2/13/20','2/14/20','2/15/20','2/16/20','2/17/20','2/18/20','2/19/20','2/20/20','2/21/20',
         '2/22/20','2/23/20','2/24/20','2/25/20','2/26/20','2/27/20','2/28/20','2/29/20','3/1/20','3/2/20',
         '3/3/20','3/4/20','3/5/20','3/6/20','3/7/20','3/8/20','3/9/20','3/10/20','3/11/20','3/12/20','3/13/20',
         '3/14/20','3/15/20','3/16/20','3/17/20','3/18/20','3/19/20','3/20/20','3/21/20','3/22/20','3/23/20',
         '3/24/20','3/25/20','3/26/20','3/27/20','3/28/20','3/29/20','3/30/20','3/31/20','4/1/20','4/2/20',
         '4/3/20','4/4/20','4/5/20','4/6/20','4/7/20','4/8/20','4/9/20','4/10/20','4/11/20','4/12/20','4/13/20',
         '4/14/20','4/15/20','4/16/20','4/17/20','4/18/20','4/19/20','4/20/20','4/21/20','4/22/20','4/23/20',
         '4/24/20','4/25/20','4/26/20','4/27/20','4/28/20','4/29/20','4/30/20','5/1/20','5/2/20','5/3/20',
         '5/4/20','5/5/20','5/6/20','5/7/20','5/8/20','5/9/20','5/10/20','5/11/20','5/12/20','5/13/20','5/14/20',
         '5/15/20','5/16/20','5/17/20','5/18/20','5/19/20','5/20/20','5/21/20','5/22/20','5/23/20','5/24/20',
         '5/25/20','5/26/20','5/27/20','5/28/20','5/29/20','5/30/20','5/31/20','6/1/20','6/2/20','6/3/20',
         '6/4/20','6/5/20','6/6/20','6/7/20','6/8/20','6/9/20','6/10/20','6/11/20','6/12/20','6/13/20','6/14/20',
         '6/15/20','6/16/20','6/17/20','6/18/20','6/19/20','6/20/20','6/21/20','6/22/20','6/23/20','6/24/20',
         '6/25/20','6/26/20','6/27/20','6/28/20','6/29/20','6/30/20','7/1/20','7/2/20','7/3/20',
         '7/4/20','7/5/20','7/6/20','7/7/20','7/8/20','7/9/20','7/10/20','7/11/20','7/12/20','7/13/20','7/14/20',
         '7/15/20','7/16/20','7/17/20','7/18/20','7/19/20','7/20/20','7/21/20','7/22/20','7/23/20','7/24/20',
         '7/25/20','7/26/20','7/27/20','7/28/20','7/29/20','7/30/20','7/31/20','8/1/20','8/2/20','8/3/20',
         '8/4/20','8/5/20','8/6/20','8/7/20','8/8/20','8/9/20','8/10/20','8/11/20','8/12/20','8/13/20','8/14/20',
         '8/15/20','8/16/20','8/17/20','8/18/20','8/19/20','8/20/20','8/21/20','8/22/20','8/23/20','8/24/20',
         '8/25/20','8/26/20','8/27/20','8/28/20','8/29/20','8/30/20','8/31/20','9/1/20','9/2/20','9/3/20',
         '9/4/20','9/5/20','9/6/20','9/7/20','9/8/20','9/9/20','9/10/20','9/11/20','9/12/20','9/13/20','9/14/20',
         '9/15/20','9/16/20','9/17/20','9/18/20','9/19/20','9/20/20','9/21/20','9/22/20','9/23/20','9/24/20',
         '9/25/20','9/26/20','9/27/20','9/28/20','9/29/20','9/30/20']

date_list = cases.columns
date_list = date_list[4:]
dates_labels = dates

#print(cases.sum(axis=0))

US_df = cases[cases['Country/Region']=='US']
China_df = cases[cases['Country/Region']=='China']
Italy_df = cases[cases['Country/Region']=='Italy']

US_cases = np.array(list(US_df.sum(axis=0))[4:])
China_cases = np.array(list(China_df.sum(axis=0))[4:])
Italy_cases = np.array(list(Italy_df.sum(axis=0))[4:])

US_df = recov[recov['Country/Region']=='US']
China_df = recov[recov['Country/Region']=='China']
Italy_df = recov[recov['Country/Region']=='Italy']

US_recov = np.array(list(US_df.sum(axis=0))[4:])
China_recov = np.array(list(China_df.sum(axis=0))[4:])
Italy_recov = np.array(list(Italy_df.sum(axis=0))[4:])

US_df = deaths[deaths['Country/Region']=='US']
China_df = deaths[deaths['Country/Region']=='China']
Italy_df = deaths[deaths['Country/Region']=='Italy']

US_deaths = np.array(list(US_df.sum(axis=0))[4:])
China_deaths = np.array(list(China_df.sum(axis=0))[4:])
Italy_deaths = np.array(list(Italy_df.sum(axis=0))[4:])


diff_China = China_cases-China_recov-China_deaths
diff_Italy = Italy_cases-Italy_recov-Italy_deaths
diff_US = US_cases-US_recov-US_deaths

print(date_list[-1])
print('\n')


dates_graph  = date_list

#frmt = 's'
frmt = '-'

extn = 2

x_dates = np.arange(len(date_list))
x_ = np.linspace(1,len(date_list)*extn,int(1E4))


#Data Fitting stuff

def logistic(x,amp,rate,center,nu):
    return amp*(1+M.e**(-rate*(x-center)))**(-1/nu)

def base_rate(x,amp,base,center,nu):
    return amp*(1+base**(-(x-center)))**(-1/nu)

def deriv_log(x,amp,rate,center,nu):
    fn = amp*rate/nu*M.e**(-rate*(x-center))*(1+M.e**(-rate*(x-center)))**(-(nu+1)/nu)
    fn = np.nan_to_num(np.asarray(fn))
    return fn

def fn_peak(fn,var,nums,guess):
    deriv_fn = diff(fn(var[0],*nums),var[0])
    deriv_2_fn = diff(deriv_fn,var[0])
    deriv_fn = lambdify(var[0],deriv_fn)
    deriv_2_fn = lambdify(var[0],deriv_2_fn)
    sol = fsolve(deriv_2_fn,guess)[0]
    return deriv_fn(sol)


US_base = curve_fit(base_rate,x_dates,US_cases,p0=[2E5,1.5,60,1],bounds=(0,[3.5E8,1E3,1000,1E3]),maxfev=1E4)[0]
China_base = curve_fit(base_rate,x_dates,China_cases,p0=[8E4,1.2,20,1],bounds=(0,[1E6,1E3,1000,1E3]),maxfev=1E4)[0]
Italy_base = curve_fit(base_rate,x_dates,Italy_cases,p0=[1E7,1.2,50,1],bounds=(0,[1E8,1E3,1000,1E2]),maxfev=1E4)[0]

US_list_changes = [[0.9636848440473317, [11.000000040046626, 43.951606871736054, 12.326128127634739, 299.7885937278694]],[0.963533508913955, [11.125000009213942, 38.70262905449923, 12.403200943456287, 263.985948462797]],[0.9637792033932349, [11.222222231164835, 33.746664426501276, 12.462550171843109, 230.181913525343]],[0.9594854505392282, [12.124312480552614, 0.3292224766694837, 9.235685438732864, 1.4266015511261527]],[0.9608954410925795, [12.828736930423002, 0.21631111856419652, 3.4319484384973373, 0.46819378192282024]],[0.9628798153846105, [13.108977726336411, 0.19334025222020843, 3.541615491423978e-11, 0.2779738642777192]],[0.9647228654633383, [13.17197904135746, 0.19162219850878603, 5.141283559963423e-13, 0.27879869872449]],[0.9663387626709823, [13.204182302779124, 0.1907213740853553, 5.373090827087002e-14, 0.2792647020110033]],[0.9677374919148577, [13.217281603023029, 0.19034418971303757, 7.1262046043042e-15, 0.2794727147265376]],[0.9689457922054396, [13.218939301921655, 0.1902949980564422, 2.5388646876871274e-11, 0.279501372504781]],[0.9699930788730655, [13.21401475319055, 0.19044555260068696, 1.001329797920838e-12, 0.27940944659904166]],[0.9657156974977055, [13.511571205272569, 0.18140032482838903, 3.527043092517223e-14, 0.28525380067120093]],[0.963423348067693, [13.771218251296958, 0.17381861373796156, 1.6910726961222402e-15, 0.2904635606107836]],[0.9623868570596412, [13.99351775920494, 0.16755435253572354, 2.233729692451117e-12, 0.29499089721316246]],[0.5458021636767846, [9846172.457080895, 0.06138800907185911, 244.7741556535792, 1.0076412251881266]],[0.6164475999626688, [39869.91783422478, 0.16207607669236643, 118.50266259175692, 1.9352856176643316]],[0.704205631791319, [87040.50342917173, 0.2049374266394136, 102.73484210770138, 1.836802485268074]],[0.7754544707719516, [112292.00413396338, 0.22040788394762903, 98.23737857346282, 1.7977710147575008]],[0.8218104231646748, [225697.3032471126, 0.19684990034331684, 105.14685079289912, 1.6321941434728415]],[0.8600690369329427, [603708.28754298, 0.1873672023642501, 113.71479354524024, 1.5613116128297875]],[0.8881431339876821, [123920.18843603355, 0.20279506032478486, 101.876996672099, 1.7231452275215793]],[0.9155192142896424, [116412.39028055107, 0.2295710380135085, 96.7631697859002, 1.8205514646056036]],[0.9366611317589166, [160588.1559184601, 0.24741023744452914, 94.8917747870275, 1.8290208458519726]],[0.9514377428695621, [181909.73423639414, 0.28325096938858146, 90.45788240867243, 1.9077721423917198]],[0.9522189346669883, [237297.10488096473, 0.36130866382136717, 82.33832185609474, 1.9926018442767914]],[0.9670099767617961, [224840.26892972644, 0.4169468922224436, 78.12352271518354, 2.0887123127938225]],[0.9693536275584484, [238571.4410411967, 0.5537312036330855, 71.12133058711628, 2.232905179345973]],[0.9817400727260308, [166558.8723664538, 0.6702013042760916, 67.70871312143673, 2.5075911104992885]],[0.9883219066558128, [583.0095963522854, 15.93200750196646, 46.55062605616889, 59.61045723084697]],[0.9859330502585811, [214658.33040429952, 0.7665082513129443, 67.09327415989152, 2.67365454107656]],[0.9919831385968714, [37480.58022076008, 1.30230422967982, 60.27711740005978, 4.326441496486108]],[0.9954839944675749, [257328.4523173512, 0.7378392661161202, 66.98793146170402, 2.4892485586551505]],[0.9974561737026226, [2754.846610144756, 1.8979247605946312, 51.654068584062415, 6.368479212456944]],[0.9984753416589506, [3424.5472218615832, 1.250094717181912, 52.37775171450998, 4.193612542057301]],[0.998915012494381, [7625.283263009227, 0.47834599005347117, 54.87841468798666, 1.5834458702935112]],[0.9990736293070137, [212477.3813875811, 0.12556348499949366, 64.07897901477227, 0.3948835635690358]],[0.9987930187934468, [2475017.507241274, 0.7492728503666781, 76.58008687066, 2.7067373867948836]],[0.9992680345952414, [7787.468355144058, 14.857788448268883, 55.76679813259771, 53.67354347006621]],[0.9881759165999988, [699158.4247569207, 1.8793001969799403, 69.28417650237662, 5.7613826869045175]],[0.9935029193100887, [2968786.9303122503, 1.0865693928144418, 72.56766229063636, 3.125370788571822]],[0.9966267816635006, [25585.559992144674, 15.774190287051402, 58.89376205403806, 45.37233608590246]],[0.9980795878231751, [39086.936197159004, 1.810192398976263, 60.163254233824844, 5.274826626099147]],[0.9987279383575137, [76432.32391029576, 0.7010314253322121, 62.08423688547913, 2.046569359223148]],[0.9992303698698389, [77020.64127021657, 0.6946633740703796, 62.10355239775319, 2.027324210999913]],[0.9994349769723327, [108878.09082770163, 0.4423681190992391, 62.696245134099065, 1.2372879251973365]],[0.9992002613192543, [426765.88410536456, 0.15267461678189512, 61.55206215363201, 0.31948662499141167]],[0.9994628496990597, [779632.288177795, 0.10985571446136519, 57.570982643498525, 0.17946591045976343]],[0.9996427440350196, [791791.8753778465, 0.10892846445110467, 57.39144421469394, 0.17624610478648342]],[0.9997292344424588, [461469.385736558, 0.15549713116405003, 62.68653658910438, 0.34910175525922144]],[0.999803015038526, [399631.88057966536, 0.1755630231504133, 63.71993989241272, 0.4281022863515688]],[0.9998133152870183, [613843.324434156, 0.12150882197814064, 58.49016245473813, 0.2070715687784624]],[0.9998560398093773, [733279.7294309947, 0.10545376519347004, 54.13046322768825, 0.13901449134912733]],[0.999861814157364, [1137955.7787319191, 0.07568022444739991, 12.53796615741298, 0.0076967449014092425]]]
China_list_changes = [[0.9990881639848314, [52041.43021413438, 0.2575591606796529, 11.697649284873473, 0.6749571838776117]],[0.9992273525629933, [52761.03994210849, 0.2500854430053087, 11.472961627330134, 0.6394529976542586]],[0.9992098609601484, [50504.31303135548, 0.27827318423272973, 12.27748961288069, 0.7784856349006805]],[0.9868602384064871, [81243.31345219823, 0.1286507163816832, 2.819624198850018e-13, 0.13435880325039967]],[0.9832079037955758, [122743.3976753402, 0.0981209900089983, 4.594499459090539e-13, 0.1418594137350001]],[0.9856569901910799, [145080.09478334643, 0.08941122727538826, 4.222881506557098e-13, 0.14199931608572358]],[0.9878791203868746, [142705.28620843272, 0.09022777687051628, 3.53702891884621e-11, 0.14199886354996427]],[0.9892876351442459, [132274.48740866745, 0.09437158629696178, 1.0821391164736847e-13, 0.1415432028285652]],[0.9901521747890003, [122391.66501404514, 0.09927693687264702, 1.3823918581114708e-12, 0.14030887288411148]],[0.9903112959752758, [112559.82696411421, 0.10551568739257777, 3.181719369866831e-15, 0.13784245207099557]],[0.9901690783351685, [102568.81204713245, 0.11847792731073477, 4.2397895110563955, 0.196326871239917]],[0.9901366559455625, [91479.9240185295, 0.15288303126986008, 12.689149247178744, 0.4633686013539065]],[0.9905357044630849, [87056.84484134072, 0.17599981583142812, 15.30530161820328, 0.6513988124199052]],[0.9908522115582082, [84071.32438716717, 0.19864041551614997, 16.97942764430302, 0.8419570627574021]],[0.9911747845723207, [82239.19493975845, 0.21772297136719862, 18.004453006537375, 1.0068505130447898]],[0.9915364956766067, [81239.71200916437, 0.23096265541778668, 18.57991335301252, 1.1233936667272262]],[0.9918923564545779, [80665.79321214324, 0.23998832006031137, 18.92556731653727, 1.2039073426627023]],[0.9922316084793537, [80356.00692706979, 0.2454950873906281, 19.121778664917368, 1.2535251097043054]],[0.9925421469335505, [80183.47862718622, 0.2488365842456208, 19.236438545655133, 1.283857163149983]],[0.9928276331484877, [80125.97036857465, 0.2500317512736367, 19.277206702173288, 1.2948018002450572]],[0.9930868401853392, [80176.97764377997, 0.24893678531774027, 19.239431184468675, 1.2847311305960634]],[0.9933181597715622, [80234.08313405579, 0.24767555740039213, 19.194535202883852, 1.2730566811886987]],[0.9935257159969338, [80284.64686819313, 0.24654500617734207, 19.15336621776973, 1.2625626649004806]],[0.9937127924866884, [80333.05034837096, 0.2454388695323278, 19.111977829007962, 1.2522413442210116]],[0.9938819164246789, [80384.89388719783, 0.24422966560425444, 19.06548199035694, 1.2408997428938722]],[0.9940351729962942, [80440.07588910025, 0.24293713236353742, 19.01474060423229, 1.2287549679693055]],[0.9941750886121576, [80490.52221037379, 0.24173804898287493, 18.966408056726987, 1.2174384658672377]],[0.9943034379107082, [80534.9512883698, 0.24067230633744804, 18.922495509548444, 1.2073487561474563]],[0.9944216228201317, [80573.59818394097, 0.23973734981492154, 18.883222090233904, 1.1984741812311677]],[0.9945307932426072, [80607.19350643235, 0.23891429939658196, 18.84796341208131, 1.1906330934832579]],[0.9946318231947456, [80637.43323010718, 0.23817296262775192, 18.815807905540154, 1.1835644680835526]],[0.9947256957621179, [80663.39748638004, 0.23753523681015914, 18.787823395612314, 1.1774773569598274]],[0.9948130882054657, [80686.27797041269, 0.23696671046137668, 18.762506265912172, 1.1720339613267872]],[0.9948945098833126, [80707.97627678803, 0.23642492930812728, 18.738115327214164, 1.1668383495946082]],[0.9949705586126776, [80728.3776570978, 0.23591362507782784, 18.714864100403354, 1.1619282828841908]],[0.9950416993497336, [80747.99720987673, 0.23542026654007203, 18.692213563989526, 1.1571844250412704]],[0.9951083985233482, [80766.7097300794, 0.23494839259281752, 18.670351879140718, 1.1526417323782459]],[0.9951709013187012, [80785.72758117953, 0.23446777693458737, 18.647888960725254, 1.1480098548645634]],[0.9952294513173943, [80805.58638166254, 0.23396242756457222, 18.6240055004739, 1.1431291951422513]],[0.995283901970697, [80828.08592291156, 0.2333951130621945, 18.597053406201177, 1.1376560152373767]],[0.9953349009797651, [80851.11711064272, 0.23281147723413126, 18.56899337563374, 1.1320143450126592]],[0.995381564920309, [80878.02394914273, 0.23212985358745733, 18.535867729222904, 1.125419029031855]],[0.9954250595612698, [80905.39720225162, 0.23143699531751585, 18.501803668503484, 1.1187082849114756]],[0.9954649922040621, [80934.48378212436, 0.23069895026381054, 18.465025630310247, 1.1115474573641557]],[0.9955019364505497, [80964.07350548528, 0.22995477864363054, 18.427589965746957, 1.1043307113340206]],[0.9955348690359211, [80996.19772355985, 0.22914544641228493, 18.386285089711418, 1.0964683406606275]],[0.9955639236049396, [81030.34150710232, 0.22828718653518384, 18.34186985375631, 1.0881218972680269]],[0.9955894724615185, [81065.82853243985, 0.2273974409523443, 18.2951479708611, 1.0794598393033419]],[0.9956109210291124, [81103.30369025333, 0.2264576657545865, 18.244979256543008, 1.0702949545311224]],[0.9956297740232306, [81140.89023803193, 0.2255231855420724, 18.19440952295409, 1.0611814300274331]],[0.9956459393697485, [81178.84321440962, 0.22457736506715983, 18.142300518229824, 1.0519367514080185]],[0.9956594438480787, [81217.06097930289, 0.2236339766442558, 18.089610722521726, 1.0427166999077895]],[0.995670727451339, [81255.25989111388, 0.22269083581515065, 18.03601233296111, 1.0334821067334756]]]
Italy_list_changes = [[0.9209728018237413, [2.4148193369259565, 2.533214516684799, 2.6372287349252588, 4.0141851384215865e-07]],[0.9166835197818508, [2.815576555299181, 0.44465430612711304, 2.2255358648545432e-12, 0.019833427380028208]],[0.9218241429271772, [2.888429338591302, 0.4063318971731045, 5.003100689455714e-13, 0.02662985329990387]],[0.9262493272938291, [2.926295023083333, 0.389364797435314, 2.2090583558904637e-09, 0.03028737382433075]],[0.929982731837551, [2.9479099187374573, 0.380285088079031, 5.536103425038017e-10, 0.03243484250827741]],[0.9331392490881487, [2.9610814405327623, 0.3748944203139197, 1.2355847030713053e-09, 0.03377934227410247]],[0.935829494550075, [2.9695565832571016, 0.37145853293409103, 2.34445696922159e-10, 0.034665290411613564]],[0.9381439008941729, [2.9752695422188187, 0.3691486623323756, 1.727693489374495e-10, 0.03527430376253484]],[0.9401534057537996, [2.979289970277387, 0.3675198835625777, 3.6516229870514545e-10, 0.035710768133632345]],[0.9419132142446632, [2.982234536055228, 0.3663205161678828, 3.226940858963678e-10, 0.03603602828934267]],[0.9434664562169971, [2.984453195622969, 0.365416808245915, 3.851838033405504e-11, 0.03628317727657105]],[0.6180044448269727, [634061.1973054264, 2.1739160882999977, 37.03500253798623, 1.474156637938621]],[0.9630669948795603, [63.017105650435056, 9.999990097085263, 30.78514438979077, 6.780964955606031]],[0.9945169869241818, [317.5458398930235, 1.4452173715997818, 32.14754276045066, 1.1229745632998553]],[0.9980556794129883, [252.3765288178224, 1.941849922228868, 32.070474127627115, 1.566726027877594]],[0.9980694624074592, [527.7659113291173, 0.4709075671176399, 11.04120559144301, 4.021263365852047e-05]],[0.9976266093804906, [1020.782078741942, 0.29562223763147943, 1.1071210537989766, 5.383146440397578e-05]],[0.9971240376057534, [3734.207999669784, 0.1621908667971331, 9.335867471685377e-10, 0.001654746503463937]],[0.9983042028733456, [7609.740939574979, 0.12832768454247862, 1.288638768969335e-09, 0.004005081962156239]],[0.9990320948497147, [6557.538575903694, 0.13468334843032667, 4.4721786541132914e-10, 0.0033955959591432374]],[0.9969140189721111, [686034.3198777908, 0.052949670949022226, 4.113994560122385e-10, 0.01980479170185736]],[0.9976034078077844, [39781.7618484097, 0.08442345666428457, 1.8539307898521244e-07, 0.011350880070663665]],[0.9984057752562855, [5804.855246460148, 0.2863195757852542, 39.46710195221515, 0.5936326830050639]],[0.9989545099405022, [13147.816479483083, 0.14237693329776444, 32.22479006145056, 0.15304182749833004]],[0.9991403682343144, [35175.85787433354, 0.08516892095145116, 3.312659385061924e-10, 0.011416458544999982]],[0.9994107242338044, [42585.1428713908, 0.08064037543036565, 1.3233538875321415e-12, 0.012770878906209511]],[0.9990459012997585, [138944.63501213441, 0.06040170214254644, 2.4160808602756525e-08, 0.02009352822970609]],[0.9989429531054924, [824702.7047660357, 0.044104419172961845, 2.8029352435087948e-11, 0.026099845303206026]],[0.9991299301353898, [6149172.877305365, 0.03398496782358969, 3.0714468622099957e-13, 0.028281426361070474]],[0.998777654195144, [10330.579483350755, 2.5892389679594454, 47.4100787314838, 11.254257579279848]],[0.9989643578330979, [378494.9728338133, 0.05066270639387247, 1.5657554929515418e-07, 0.02347764515707526]],[0.9982273637588982, [13276.5417618868, 0.9857983362031053, 48.45258868980739, 4.263895582211882]],[0.9937500065297392, [495619.08130232623, 0.04685225799277869, 8.267493917670326e-10, 0.02585251228494273]],[0.9947770396426749, [12268172.771860544, 0.029042234405655037, 4.8499137998682534e-08, 0.03122402377899353]],[0.9963170192796091, [42393894.309658654, 0.02540535986946556, 6.765553972190786e-07, 0.03102926585953773]],[0.9971588601432155, [5501733.673981617, 0.03222125663862796, 2.7560799374706786e-09, 0.030697998919911318]],[0.9976277992104792, [38328.403939483134, 0.6690037776296395, 54.96120430568213, 3.459695566519935]],[0.9982041862936123, [63232.714761341136, 0.27019741973592437, 56.26515787320152, 1.2771701830299604]],[0.9985935514824463, [135054.11427027182, 0.13015616776974484, 55.644459315075956, 0.5088419632576981]],[0.9988778417637544, [402568.9256337, 0.06544321517562944, 43.76061229550599, 0.1541337785002551]],[0.9991098890858464, [1082670.027420272, 0.04148277995951612, 4.259040531015832e-10, 0.02753903861506969]],[0.9992934670419352, [630573.9163175721, 0.0526849017782017, 31.827529368363376, 0.08648449665198281]],[0.9993223646865739, [189922.27757053223, 0.11217300101224996, 56.47107054776201, 0.43720591653674085]],[0.9994016790864856, [133576.65929663874, 0.1562275760464984, 58.56484519178165, 0.7080282436760558]],[0.9994977400143852, [120404.97374156624, 0.1771247202005916, 59.020399490851155, 0.8408010301336328]],[0.9995765111588205, [128659.19876574035, 0.1622171997109981, 58.652781158608164, 0.7438959057804693]],[0.9996316049044828, [139001.6324653422, 0.1465256089287371, 58.01166433908747, 0.640016715632627]],[0.9996713773861887, [150339.1403330171, 0.132355647343067, 57.08032992845573, 0.5443569117430894]],[0.9997163326421528, [155286.00697068003, 0.126870916080611, 56.575294664165256, 0.5064848407021957]],[0.999751264401934, [151101.88499708005, 0.13177549442621836, 57.06402218556175, 0.5412746858220437]],[0.9997769053522421, [147071.67362408608, 0.13732580729004806, 57.57998677049452, 0.581797065425746]],[0.9998036134366811, [147744.59572732451, 0.13629591086631007, 57.483388095811016, 0.5740720224142591]],[0.9998207525835842, [150501.55106939634, 0.13201404378829287, 57.025654563548144, 0.5411539528365261]]]

US_peak_chgs = [[0.9493283025188983, [170.31639543055434, 0.34770838710875185, 16.74666023930057, 2.01878045616741]],[0.9356992680401522, [188.73124248451455, 0.24454016464434233, 15.429060711250465, 1.1534876144279238]],[0.9254520311517924, [208.44447242729012, 0.18659886749307944, 13.000988724302506, 0.6814722444119159]],[0.907503960339962, [243.56803906265029, 0.1321767530314674, 5.096971434206054, 0.2516129430169559]],[0.8978714843750254, [281.2231708205244, 0.10143627331854772, -23.739621875051203, 0.017517801490421755]],[0.8912254629970188, [299.5852655004569, 0.0946977166037782, -78.97389324331888, 0.00011633552147799625]],[0.8994476656552557, [-634.2259776725709, -0.3119365891008922, 7.586830632382007, 15.030265825605149]],[0.878646649580132, [332.27406572709214, 0.08603265196113453, -95.46915240348379, 5.8626505105376705e-05]],[0.8726473314166354, [348.7219476743647, 0.08223879880170007, -97.56976565222216, 7.242590398780245e-05]],[0.8994215949857804, [-1201.628219165021, -0.3338369312395542, 6.8418894779757995, 34.59909099072331]],[0.861096546748523, [381.6714941263645, 0.07555322036266153, -112.02805069193491, 4.850703236375322e-05]],[0.8554908959866666, [398.16324538863216, 0.0725955598118349, -116.9558604189707, 4.808313269531782e-05]],[0.9015618527170149, [-2041.2921379464487, -0.34612299910981076, 6.513552485820166, 64.42765686699218]],[0.8445138328972309, [431.15594197023523, 0.0673169224219806, -124.69323864006542, 5.467673575228554e-05]],[0.36389878000542986, [389579.3166983558, 0.11147401979632517, 169.5819449729027, 2.1827615188257243]],[0.47244494852940244, [1906101.3966605528, 0.15103728680008377, 143.78867365920524, 1.9237952184547524]],[0.6028335900318795, [987468.0472773028, 0.2770564879900586, 96.80741949741137, 2.127258814421579]],[0.7047152276853649, [7966817.134680636, 0.2433562358492077, 104.8291250972404, 1.6673416748407806]],[0.7639512614725764, [2330063.1654657214, 0.2535278714383186, 100.8075843218029, 1.8697582749791055]],[0.8136596556149687, [2897122.1782003217, 0.23513308268390617, 104.48261231195555, 1.7910277798239471]],[0.8512423333857592, [594635.7082918315, 0.27365742014156896, 94.1756691064283, 2.154347661910488]],[0.8898190477582204, [2362829.008590273, 0.24955499449014093, 102.04978518631526, 1.873192588691133]],[0.9196848894145065, [5235357.453784539, 0.2524218384730372, 104.04648398773651, 1.7812083236864393]],[0.9414459504473001, [647396.235037089, 0.3675046906766182, 85.6051788160403, 2.388459762396087]],[0.9452430732367743, [2581988.1556941536, 0.40732437479684575, 84.68904981693875, 2.1333591102837075]],[0.9634562413664962, [21241521.481454186, 0.35426368506343536, 90.85202011582814, 1.6789146420413603]],[0.967955252651731, [2552577.98814248, 0.6158796222778143, 73.5248102284886, 2.317502065561662]],[0.981846513244059, [753014.1122201204, 0.7996307967217684, 67.52270191348441, 2.8217161467986847]],[0.9885389011794472, [2328.70614839849, 14.781179130870658, 47.13068290937863, 52.15943494794868]],[0.9862332634923945, [64626028.93641772, 0.5124702980063883, 81.38871943543205, 1.7091325586111936]],[0.9924831771756325, [799162.6936137557, 0.9916647689297157, 66.06196246871215, 3.1807252958183683]],[0.995869724963417, [5765.500706206, 13.947525759297593, 50.243810895429846, 44.73613515946217]],[0.9976173993938549, [14024.046201396832, 1.4446445585602021, 53.13498663473031, 4.695847141848511]],[0.9985758138835472, [20261.28327860879, 0.9478143775829716, 54.314605673955505, 3.0763448284450687]],[0.9989709777235687, [67014.45663970425, 0.36407969314195054, 57.838830866224825, 1.1500929858386737]],[0.9991237205994471, [4312424.660139464, 0.08967944101834044, 66.11833090399514, 0.24774284558629994]],[0.998808681630513, [823642.9996937804, 1.4085714786793426, 67.93392995480217, 5.035183463056464]],[0.9992731345015321, [30938.742017806504, 12.46354196825835, 56.20282199274733, 44.5530865313321]],[0.9880170913128126, [39525864.17119273, 0.8388022479621029, 78.26682100188975, 2.5678685063373377]],[0.9933898350639593, [1380614.3897213065, 1.852896582163626, 67.36416117741206, 5.310402860971564]],[0.9965785458959119, [82059.98684341977, 11.80122559667812, 59.27391339355566, 33.822316487194804]],[0.9980541843083112, [172177.8359176856, 1.6889787023933538, 61.43028011847308, 4.910129312422096]],[0.9987062442266781, [466154.6577909073, 0.6216283332930962, 64.27156624031949, 1.8069119809093337]],[0.9992156567387142, [494607.52507491206, 0.590909590019599, 64.42396920900222, 1.7137882942326141]],[0.9993890282006539, [952312.4774276891, 0.3330090568654172, 65.60045378210336, 0.9027463576893895]],[0.9991800718310168, [6579139.846433583, 0.11198875073307743, 62.46639173639022, 0.20203271172125878]],[0.9994477835043377, [14936999.770001236, 0.0794850403582721, 53.95173868161008, 0.09663129618188292]],[0.9996315602141321, [16275916.783807527, 0.07669635966663109, 52.30814968327945, 0.08703502366170641]],[0.9996983212512586, [5774716.404569322, 0.12922760970182207, 65.80389281606558, 0.2825311737151448]],[0.9997696136134736, [4211600.128385118, 0.15948280549394356, 67.75635366528866, 0.40319773927426156]],[0.9997370125812829, [8700534.00792049, 0.09790955478299074, 59.42509893481932, 0.14958390724668733]],[0.9997700146228017, [14213925.667955182, 0.07319893961747398, 41.289037163722526, 0.04575105602750133]],[0.9997196313436548, [22267573.48388633, 0.059474493688496964, -51.419265076768276, 0.00024613814097699166]]]
China_peak_chgs = [[-1.1808702549150647, [7501951.754170722, 14.451419554958104, 60.613824410816825, 98719.88835558711]],[-1.1670775733974414, [7500857.535829304, 14.461691452412616, 60.55408160143987, 65427.29608520814]],[-1.1205563988424974, [7500361.84569305, 14.487221673896427, 60.42508174197554, 42485.66949375727]],[-1.0362678933080356, [7500193.236963539, 11.593033746923897, 60.52475513111718, 31062.33902396473]],[-0.8467456287659405, [7500097.845042099, 14.40170058639318, 59.68868036157729, 22071.662689449113]],[-0.7691790975132504, [7500045.35595313, 11.716032060057628, 59.81193688862634, 15023.880145189753]],[-0.571258590460626, [7500020.0749416705, 11.876144474436884, 58.9864447702173, 9981.64694706422]],[0.6454042154673598, [7500008.623655178, 30.00430058894424, 32.658438049035645, 6222.206590311338]],[-0.05003786073115868, [7500003.638104377, 12.323734242626802, 56.77470253946109, 4231.957531576644]],[0.5381315232464813, [7499982.763697201, 15.088808441199692, 61.045470118305964, 2733.419844586202]],[0.0030508060160689965, [7500000.604668758, 7.259302144379274, 96.24506521554459, 1770.6817221630545]],[0.14956999076876776, [7500000.24720001, 7.389558777505462, 94.30419924476985, 1120.707588126363]],[-0.38684018141284926, [1883921.0630948842, 22.425441843101424, 31.216993092261365, 2611.6285077267153]],[0.4583680456836937, [1883917.3629978525, 28.78152571416912, 32.66681656810171, 1625.0164473239734]],[0.867143210168376, [1883911.3608209167, 31.72511111088048, 34.391641184606016, 907.9013533728744]],[0.7611589885328456, [7495746.466770914, 8.647721393529787, 67.2429046011754, 163.68831930807886]],[0.7815521521039988, [1883896.6108759579, 19.284769005804637, 40.864713418440445, 418.1178408023589]],[0.6917979343326981, [1883943.8707624595, 15.413873081648756, 41.731892800718775, 341.2888925468271]],[0.6503367325485768, [1883934.9450532582, 8.785511534009327, 41.883364074402834, 211.24072691192458]],[0.6061140566456689, [7495639.739819154, 1.1931965412536107, 77.99733478716061, 31.20321435305844]],[0.9875310605866569, [1647519.2323961211, 0.11085539161917206, 18.201710452610726, 0.36850008675929824]],[0.9875297812980466, [1648657.0728261725, 0.11066637457537085, 18.13663051144997, 0.36642178037325235]],[0.9875330872934213, [1648983.789345507, 0.11060887524971878, 18.116274480041714, 0.3657747642893899]],[0.9875484426608526, [1648671.6848166552, 0.11066663169324367, 18.137257675227083, 0.36643957421688667]],[0.9875812015820058, [1648654.0314928014, 0.11066997715039827, 18.138493837101205, 0.36647848163976626]],[0.6712312754389747, [1033675.3280863594, 0.18032311283125754, 25.442109086529168, 0.7118743519084209]],[0.2990456567815032, [1372253.1828263726, 21.822496475672178, 37.01534056638399, 442.4809818286694]],[0.9876837908642753, [1656281.7467180495, 0.10913329807167907, 17.529249815407713, 0.34798546345216014]],[0.9877323855031389, [1659024.503215297, 0.1085534920093666, 17.281295758590847, 0.34082471702114703]],[0.9877855078804707, [1661769.2132742377, 0.10796118721082268, 17.017732595699297, 0.3334246695460659]],[0.9878695187476961, [1664064.9911941607, 0.10745581726198258, 16.784226331701166, 0.3270417830160371]],[0.9879687159346738, [1666172.2529214867, 0.1069828367393748, 16.558026384985, 0.3210069674772777]],[0.9880980634477091, [1667881.7492810292, 0.10659163406382018, 16.364940700385787, 0.31596642173771244]],[0.9882773894629633, [1668874.3085599127, 0.10635977032710925, 16.247558520482773, 0.31295067881266]],[0.9884884486174984, [1669324.5939947013, 0.10625218240501358, 16.192090849618296, 0.3115382484044005]],[0.9887008195318318, [1669840.9541341239, 0.10612597506654074, 16.126022259501667, 0.3098662758855858]],[-0.0478011719552367, [8361800.921172615, 0.03021938217605543, 156.427133971925, 3.5621696742516153]],[0.989141398874068, [1670601.0742392023, 0.10593465560667638, 16.02384922270312, 0.30730243279794267]],[0.9893649386776625, [1670867.9679135669, 0.10586528308693754, 15.986092648572127, 0.3063616487786659]],[0.9895845737905646, [1671136.9883002394, 0.10579396230563734, 15.946838447727352, 0.30538720635460265]],[0.9897969375771588, [1671437.4375261695, 0.10571295094814467, 15.901798200364041, 0.3042737955929504]],[0.989994713746491, [1671833.9932074714, 0.10560418982335423, 15.840631961231834, 0.3027694207479236]],[0.9901795982503816, [1672272.9966533869, 0.10548205310944714, 15.771154649185172, 0.30107139779832176]],[0.990353654623255, [1672720.983882582, 0.10535566510956051, 15.69839468457238, 0.29930515289162296]],[0.9905236643177608, [1673121.9337096198, 0.10524108590080047, 15.631685416843258, 0.29769648669101084]],[0.9906815857594047, [1673532.8321174388, 0.10512220877306924, 15.561715854353459, 0.29602004887418143]],[0.9908408739052944, [1673865.0332786054, 0.10502498761574651, 15.503914230136903, 0.2946434551039946]],[0.9909921361433749, [1674182.0699335684, 0.10493116166296317, 15.447612218515173, 0.2933096881935441]],[0.9911431970874138, [1674437.6576732094, 0.10485468992503777, 15.401331811926257, 0.29221855765841415]],[0.9912889732417659, [1674666.4772079354, 0.10478559271144688, 15.359220315286416, 0.291229850524501]],[0.9914269004876107, [1674886.1791943747, 0.10471858456177743, 15.318087543680178, 0.2902678126782529]],[0.9915534352108754, [1675115.569550902, 0.10464782017456664, 15.27430041475183, 0.289247550607093]],[0.9916679182659149, [1675354.8546993907, 0.1045733473386343, 15.22789300836873, 0.28817072150697065]]]
Italy_peak_chgs = [[0.8870776160010011, [57.37977929917619, 0.14223449006624447, 9.231255868619984e-35, 0.07914747963284044]],[0.8956611360561348, [60.792002986210036, 0.13712381659627243, 1.6232002984313922e-33, 0.08160971398668247]],[0.9022217990395207, [63.7045695782415, 0.13297934504829037, 1.8066686415537408e-32, 0.08375724175746568]],[0.907177683114786, [66.53159876935102, 0.12911046478064953, 2.1311838795060666e-33, 0.0859093542739525]],[0.9108189755418623, [69.4266451002619, 0.1252950805123257, 2.2812328087844487e-32, 0.0881843331758158]],[0.9133470838536037, [72.43584179105905, 0.1214886697103512, 1.279612883771581e-33, 0.09060673213451016]],[0.9149110128569917, [75.56793570677668, 0.11770078192959066, 1.6569421742623741e-31, 0.09317018203354677]],[0.9156290853665391, [78.81611160194801, 0.113959344369069, 3.075574211915452e-32, 0.09585170923286396]],[0.9156005387498009, [82.16923164243178, 0.11029231599830236, 1.5062555716931556e-12, 0.09862443861728021]],[0.9149114958266098, [85.61561446102641, 0.10672253421670469, 1.2476273143494325e-15, 0.10146214985919863]],[0.9136380677129546, [89.14461251906489, 0.10326643406709445, 6.626837633071606e-16, 0.1043415033878938]],[0.5802707925874784, [662688.4162924247, 2.39000375237791, 37.7902039876719, 1.7240259240049933]],[0.9590215609136592, [39693.03409008803, 1.103378585104384, 36.663614429581976, 0.9368987922530302]],[0.9941544671169558, [493.10233381603865, 1.7078333635705525, 32.83464776175151, 1.3892729140376527]],[0.9970292129973767, [1726.4403464563638, 0.40554544797148084, 2.2274582056853403, 2.3119932023435436e-06]],[0.9975989250048714, [3413.798025707991, 0.2944762710745241, 2.033764217297275, 4.724219820972092e-05]],[0.9971599989156686, [8932.21601803691, 0.19847480995723468, 1.4106209149155274e-07, 0.00043699826089360215]],[0.9977817400875657, [19887.14927800081, 0.15084919730367327, 1.583710249288703e-36, 0.0016961071013481014]],[0.9978419054689244, [69984.17567976506, 0.10632959788499109, 3.303048448429134e-10, 0.005621072312804188]],[0.9987508612484931, [93278.60063576952, 0.09917189713555008, 1.1960655926748153e-18, 0.006744632746788941]],[0.9967183420181152, [2738581.0212095585, 0.06818296939143897, 33.693133316808144, 0.08251442878238922]],[0.9975781123298293, [6751.4330339688295, 13.66156930004962, 40.12169442541126, 40.37255835454484]],[0.9980331486572724, [47346.65063288953, 0.2300713636547489, 42.056411497048416, 0.47086399641017057]],[0.9986965654319524, [80856.17940552958, 0.1590917585970297, 39.42130010348482, 0.2519504013394697]],[0.9989539712430583, [207620.77277868165, 0.09545843541408199, 25.856144556518778, 0.06548088425083268]],[0.9992174087551258, [382186.9397626612, 0.07381872517505018, 2.3666331096787617e-26, 0.012325965141824127]],[0.99797224660182, [1977383.6586964203, 0.05181119881835015, 4.7683058991092653e-23, 0.020620243068266146]],[0.9976429605099252, [5073741.256588412, 0.0559572914631418, 40.91169185254492, 0.10779420663917552]],[0.9980440741141928, [3484745.787538818, 0.09855748163147277, 61.375882277552975, 0.35575948088278686]],[0.9984104495552902, [47519.45884003328, 7.33641425433838, 48.276945538433054, 32.82102719040781]],[0.9984232796605466, [4343090.993863824, 0.05397400569445682, 32.80752581662689, 0.0791177409290615]],[0.9984446796429549, [96478.24519403749, 0.7335076734423851, 51.34707576744306, 3.238754813471348]],[0.9934179694620534, [7002762.573278176, 0.04484542172715293, 17.370966872782716, 0.044309593670437374]],[0.9945217712494288, [13849237.99665376, 0.052471470615282935, 54.2598652302434, 0.15092567035428406]],[0.9961351710918646, [57838604.51623237, 0.03877290622535165, 48.11700303963656, 0.0966035967672988]],[0.9969689739904698, [19609131.627261054, 0.04422267230456964, 43.390901599737596, 0.0974275613211023]],[0.9975741980465546, [2427067.1277689207, 0.09391919387408532, 59.73465194277638, 0.3445881227411019]],[0.9981027184285992, [560974.7346389975, 0.25718840613159644, 60.18455848726639, 1.2480291845781353]],[0.9983900538577302, [1891807.5317537268, 0.10308116644187641, 59.55653717695901, 0.3851299661733187]],[0.9985260143652599, [10386208.307692379, 0.04713401213651311, 37.421992618239265, 0.08651994174321076]],[0.9988595262495679, [11511621.053586874, 0.04579497724674416, 36.17482344649434, 0.08209438158618569]],[0.9990637439030338, [8788010.188182019, 0.04992867712759462, 40.539402516817454, 0.09847188717637119]],[0.9992128688371253, [4012551.068295643, 0.07425357403500685, 57.51318436679792, 0.24452730769884046]],[0.9992810565187612, [2138855.917242056, 0.11207186120229687, 63.217799612602406, 0.4830104996609121]],[0.9993912874723411, [1837268.3269405542, 0.126833798087155, 64.00711414079478, 0.5800457857188125]],[0.9994646368740291, [2185295.0624612295, 0.10928884707753049, 62.85259547305594, 0.4619876601547592]],[0.9994977779085323, [2720652.5231317966, 0.09130654831284217, 60.31907394828505, 0.3393425209955868]],[0.9995527310766634, [3081388.2499034526, 0.08268409397560467, 58.114545285561086, 0.27950952399676615]],[0.9995958060846167, [3457068.619595876, 0.075468150562673, 55.304244180063655, 0.2283175968228626]],[0.9996354890744037, [3210809.9144261447, 0.08022357254880823, 57.36256082855113, 0.26312907486648274]],[0.9996708137147023, [3065925.3391480525, 0.08361554726883152, 58.631214946342524, 0.288933341028142]],[0.9996999521725124, [3189062.1852539014, 0.08056104020084834, 57.43681451199894, 0.2649455249548849]],[0.9997122349707275, [3379724.4249640964, 0.07617241792909209, 55.277473373627764, 0.2296067171291155]]]





ndays = 20


for i in range(ndays+len(US_list_changes),len(x_dates)+1):
    print(i)
    US_max_r = []
    US_max_peak = []
    
    China_max_r = []
    China_max_peak = []
    
    Italy_max_r = []
    Italy_max_peak = []
    
    for j in range(int(4E1),int(7E1)+1,6):
#        if j%1E1 ==0:
#            print(10**(j/1E1))
#        print(10**(j/1E1))
        try:
            US_max_r.append(r_sqr(x_dates[:i],US_cases[:i],logistic,[10**(j/1E1),0.2,60,1],(0,[3.5E8,1E3,1E3,1E3]),1E4))
        except:
            None
        try:
            China_max_r.append(r_sqr(x_dates[:i],China_cases[:i],logistic,[10**(j/1E1),0.4,20,1],(0,[2E9,1E3,1E3,1E3]),1E4))
        except:
            None
        try:
            Italy_max_r.append(r_sqr(x_dates[:i],Italy_cases[:i],logistic,[10**(j/1E1),0.25,40,1],(0,[1E8,1E1,1E3,1E3]),1E4))
        except:
            None
        try:
            US_max_peak.append(r_sqr(x_dates[:i],diff_US[:i],deriv_log,[10**(j/1E1),1E-1,6E1,2E-1],(-np.inf,np.inf),1E5))
        except:
            None
        try:
            China_max_peak.append(r_sqr(x_dates[:i],diff_China[:i],deriv_log,[10**(j/1E1),1E-1,6E1,2E-1],(0,np.inf),1E5))
        except:
            None
        try:
            Italy_max_peak.append(r_sqr(x_dates[:i],diff_Italy[:i],deriv_log,[10**(j/1E1),1E-1,6E1,2E-1],(0,np.inf),1E5))
        except:
            None
    
    
    US_list_changes.append(US_max_r[np.where(np.array(US_max_r)[:,0] == max(np.array(US_max_r)[:,0]))[0][0]])
    China_list_changes.append(China_max_r[np.where(np.array(China_max_r)[:,0] == max(np.array(China_max_r)[:,0]))[0][0]])
    Italy_list_changes.append(Italy_max_r[np.where(np.array(Italy_max_r)[:,0] == max(np.array(Italy_max_r)[:,0]))[0][0]])
    
    US_peak_chgs.append(US_max_peak[np.where(np.array(US_max_peak)[:,0] == max(np.array(US_max_peak)[:,0]))[0][0]])
    China_peak_chgs.append(China_max_peak[np.where(np.array(China_max_peak)[:,0] == max(np.array(China_max_peak)[:,0]))[0][0]])
    Italy_peak_chgs.append(Italy_max_peak[np.where(np.array(Italy_max_peak)[:,0] == max(np.array(Italy_max_peak)[:,0]))[0][0]])

#    US_list_changes.append(r_sqr(x_dates[:i],US_cases[:i],logistic,[2E5,0.2,60,1],(0,[3.5E8,1E3,1E3,1E3]),1E4))
#    China_list_changes.append(r_sqr(x_dates[:i],China_cases[:i],logistic,[8E4,0.4,20,1],(0,[2E9,1E3,1E3,1E3]),1E4))
#    Italy_list_changes.append(r_sqr(x_dates[:i],Italy_cases[:i],logistic,[3E5,0.25,40,1],(0,[1E8,1E1,1E3,1E3]),1E4))
#    
#    US_peak_chgs.append(r_sqr(x_dates[:i],US_cases[:i]-US_recov[:i],deriv_log,[5.6E6,1E-1,6E1,2E-1],(-np.inf,np.inf),1E5))
#    China_peak_chgs.append(r_sqr(x_dates[:i],China_cases[:i]-China_recov[:i],deriv_log,[6E6,1E-1,6E1,2E-1],(0,np.inf),1E5))
#    Italy_peak_chgs.append(r_sqr(x_dates[:i],Italy_cases[:i]-Italy_recov[:i],deriv_log,[4E6,1E-1,6E1,2E-1],(0,np.inf),1E5))


US_r_2_chgs = []
China_r_2_chgs = []
Italy_r_2_chgs = []

US_amp_chgs = []
China_amp_chgs = []
Italy_amp_chgs = []

US_rate_chgs = []
China_rate_chgs = []
Italy_rate_chgs = []

US_center_chgs = []
China_center_chgs = []
Italy_center_chgs = []

US_nu_chgs = []
China_nu_chgs = []
Italy_nu_chgs = []

US_peak = []
China_peak = []
Italy_peak = []


#fn_peak(logistic,[x,b,d,e,f],[*US_list_changes[j]],8E1)

for j in range(len(US_list_changes)):
    US_r_2_chgs.append(US_list_changes[j][0])
    US_amp_chgs.append(US_list_changes[j][1][0])
    US_rate_chgs.append(US_list_changes[j][1][1])
    US_center_chgs.append(US_list_changes[j][1][2])
    US_nu_chgs.append(US_list_changes[j][1][3])
    US_peak.append(1 if max(deriv_log(x_,*US_peak_chgs[j][1]))>=np.nan_to_num(np.inf)/10 else max(deriv_log(x_,*US_peak_chgs[j][1])))
    
#    1 if US_list_changes[j][0] >= np.nan_to_num(np.inf)/10 else: US_list_changes[j][0]
    
    China_r_2_chgs.append(China_list_changes[j][0])
    China_amp_chgs.append(China_list_changes[j][1][0])
    China_rate_chgs.append(China_list_changes[j][1][1])
    China_center_chgs.append(China_list_changes[j][1][2])
    China_nu_chgs.append(China_list_changes[j][1][3])
    China_peak.append(1 if max(deriv_log(x_,*China_peak_chgs[j][1]))>=np.nan_to_num(np.inf)/10 else max(deriv_log(x_,*China_peak_chgs[j][1])))
    
    Italy_r_2_chgs.append(Italy_list_changes[j][0])
    Italy_amp_chgs.append(Italy_list_changes[j][1][0])
    Italy_rate_chgs.append(Italy_list_changes[j][1][1])
    Italy_center_chgs.append(Italy_list_changes[j][1][2])
    Italy_nu_chgs.append(Italy_list_changes[j][1][3])
    Italy_peak.append(1 if max(deriv_log(x_,*Italy_peak_chgs[j][1]))>=np.nan_to_num(np.inf)/10 else max(deriv_log(x_,*Italy_peak_chgs[j][1])))



plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],US_r_2_chgs,frmt)
#plt.plot(x_dates[4:],US_r_2_chgs,frmt)
plt.suptitle('US R^2')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],US_amp_chgs,frmt)
#plt.plot(x_dates[4:],US_amp_chgs,frmt)
plt.suptitle('US Max Cases')
#plt.yscale('log')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],US_amp_chgs,frmt)
#plt.plot(x_dates[4:],US_amp_chgs,frmt)
plt.suptitle('US Max Cases')
plt.yscale('log')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],US_rate_chgs,frmt)
#plt.plot(x_dates[4:],US_rate_chgs,frmt)
plt.suptitle('US Growth Rate')
plt.yscale('log')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],US_center_chgs,frmt)
#plt.plot(x_dates[4:],US_center_chgs,frmt)
plt.suptitle('US Turnover Dates')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],US_peak[0:],frmt)
#plt.plot(x_dates[4:],US_center_chgs,frmt)
plt.suptitle('US Peak # of Cases')
#plt.yscale('log')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],US_peak[0:],frmt)
#plt.plot(x_dates[4:],US_center_chgs,frmt)
plt.suptitle('US Peak # of Cases')
plt.yscale('log')
plt.show()
plt.clf()


print('\n\n')


plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],China_r_2_chgs,frmt)
#plt.plot(x_dates[4:],China_r_2_chgs,frmt)
plt.suptitle('China R^2')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],China_amp_chgs,frmt)
#plt.plot(x_dates[4:],China_amp_chgs,frmt)
plt.suptitle('China Max Cases')
#plt.yscale('log')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],China_amp_chgs,frmt)
#plt.plot(x_dates[4:],China_amp_chgs,frmt)
plt.suptitle('China Max Cases')
plt.yscale('log')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],China_rate_chgs,frmt)
#plt.plot(x_dates[4:],China_rate_chgs,frmt)
plt.suptitle('China Growth Rate')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],China_center_chgs,frmt)
#plt.plot(x_dates[4:],China_center_chgs,frmt)
plt.suptitle('China Turnover Dates')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays+30::7])
plt.plot(dates_graph[ndays-1+30:],China_peak[30:],frmt)
#plt.plot(x_dates[4:],US_center_chgs,frmt)
plt.suptitle('China Peak # of Cases')
#plt.yscale('log')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays+30::7])
plt.plot(dates_graph[ndays-1+30:],China_peak[30:],frmt)
#plt.plot(x_dates[4:],US_center_chgs,frmt)
plt.suptitle('China Peak # of Cases')
plt.yscale('log')
plt.show()
plt.clf()


print('\n\n')


plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],Italy_r_2_chgs,frmt)
#plt.plot(x_dates[4:],Italy_r_2_chgs,frmt)
plt.suptitle('Italy R^2')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],Italy_amp_chgs,frmt)
#plt.plot(x_dates[4:],Italy_amp_chgs,frmt)
plt.suptitle('Italy Max Cases')
#plt.yscale('log')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],Italy_amp_chgs,frmt)
#plt.plot(x_dates[4:],Italy_amp_chgs,frmt)
plt.suptitle('Italy Max Cases')
plt.yscale('log')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],Italy_rate_chgs,frmt)
#plt.plot(x_dates[4:],Italy_rate_chgs,frmt)
plt.suptitle('Italy Growth Rate')
plt.yscale('log')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],Italy_center_chgs,frmt)
#plt.plot(x_dates[4:],Italy_center_chgs,frmt)
plt.suptitle('Italy Turnover Dates')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],Italy_peak[0:],frmt)
#plt.plot(x_dates[4:],Italy_center_chgs,frmt)
plt.suptitle('Italy Peak # of Cases')
#plt.yscale('log')
plt.show()
plt.clf()

plt.xticks(rotation=45)
plt.xticks(ticks=np.arange(0,len(dates_graph)*extn+1,7),labels=dates_graph[ndays::7])
plt.plot(dates_graph[ndays-1:],Italy_peak[0:],frmt)
#plt.plot(x_dates[4:],Italy_center_chgs,frmt)
plt.suptitle('Italy Peak # of Cases')
plt.yscale('log')
plt.show()
plt.clf()


print('\n\n')

print('1 infection leads to {:.3f} times more infections per week in the US'.format(US_base[1]**7))
print('1 infection leads to {:.3f} times more infections per week in China'.format(China_base[1]**7))
print('1 infection leads to {:.3f} times more infections per week in Italy'.format(Italy_base[1]**7))

print('\n\nUS confirmed cases = {} on {}'.format(int(US_cases[-1]),date_list[-1]))
print('\nChina confirmed cases = {} on {}'.format(int(China_cases[-1]),date_list[-1]))
print('\nItaly confirmed cases = {} on {}'.format(int(Italy_cases[-1]),date_list[-1]))


print('\n\n\n')



